{% extends 'base.html' %}
{% load static %}

{% block title %}Checkout - JOOG{% endblock %}

{% block content %}
<div class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">Checkout</h1>
            <p class="text-gray-600">Enter your shipping details and place your order</p>
        </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Shipping Information -->
        <div class="bg-white rounded-lg shadow-sm p-6 max-w-lg mx-auto">
            <h2 class="text-xl font-bold mb-6 text-gray-800">Shipping Information</h2>
            
            <!-- Address Management Section -->
            <div class="mb-6">
                <!-- Quick Actions -->
                <div class="text-center space-x-4 mb-6">
                    <button type="button" id="add-address-modal-btn" class="text-red-600 hover:text-red-700 font-semibold text-sm bg-red-50 hover:bg-red-100 px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-plus mr-1"></i>Add New Address Here
                    </button>
                    <a href="{% url 'accounts:add_address' %}" class="text-gray-600 hover:text-gray-700 font-semibold text-sm">
                        <i class="fas fa-external-link-alt mr-1"></i>Manage All Addresses
                    </a>
                </div>
                
                <!-- Address Selection -->
                {% if user_addresses %}
                <h3 class="font-semibold mb-3">Select Address</h3>
                <div class="space-y-2 mb-4">
                    {% for address in user_addresses %}
                    <label class="flex items-start space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer address-option" data-address-id="{{ address.id }}">
                        <input type="radio" name="selected_address" value="{{ address.id }}" class="mt-1" {% if address.is_default %}checked{% endif %}>
                        <div class="flex-1">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-{% if address.address_type == 'home' %}home{% elif address.address_type == 'work' %}building{% else %}map-marker-alt{% endif %} text-red-600"></i>
                                <span class="font-semibold">{{ address.get_address_type_display }}</span>
                                {% if address.is_default %}
                                <span class="bg-red-600 text-white px-2 py-1 rounded text-xs font-semibold">DEFAULT</span>
                                {% endif %}
                            </div>
                            <p class="text-sm text-gray-600 mt-1">{{ address.get_full_address }}</p>
                        </div>
                    </label>
                    {% endfor %}
                    
                    <!-- Option for new address -->
                    <label class="flex items-start space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer address-option" data-address-id="new">
                        <input type="radio" name="selected_address" value="" class="mt-1" id="new_address_radio">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-plus text-red-600"></i>
                                <span class="font-semibold">Use a new address</span>
                            </div>
                            <p class="text-sm text-gray-600 mt-1">Enter address details below</p>
                        </div>
                    </label>
                </div>
                {% else %}
                <!-- No saved addresses message -->
                <div class="text-center p-6 bg-gray-50 rounded-lg mb-4">
                    <i class="fas fa-map-marker-alt text-gray-400 text-2xl mb-2"></i>
                    <p class="text-gray-600 mb-2">No saved addresses found</p>
                    <p class="text-gray-500 text-sm">Add an address to your account or enter details below</p>
                </div>
                {% endif %}
            </div>
            
            <div class="border-t pt-6"></div>
            
            <!-- Legacy saved address option -->
            {% if has_legacy_address and not user_addresses %}
            <div class="mb-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
                <label class="flex items-start space-x-3">
                    <input type="checkbox" id="use_saved" name="use_saved" value="1" class="mt-1">
                    <div>
                        <p class="font-semibold">Use saved address</p>
                        <p class="text-sm text-gray-600">{{ legacy_address.address }}, {{ legacy_address.city }}{% if legacy_address.state %}, {{ legacy_address.state }}{% endif %}, {{ legacy_address.postal }}, {{ legacy_address.country }}</p>
                    </div>
                </label>
            </div>
            {% endif %}
            
            <form method="POST" id="checkout-form">
                {% csrf_token %}
                <div class="space-y-6">
                    <div>
                        <label class="form-label">{{ form.shipping_address.label_tag }}</label>
                        {{ form.shipping_address }}
                        {% if form.shipping_address.errors %}
                        <div class="form-error">{{ form.shipping_address.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">{{ form.shipping_city.label_tag }}</label>
                            {{ form.shipping_city }}
                            <div class="text-xs text-gray-500 mt-1">City may auto-fill from PIN</div>
                            {% if form.shipping_city.errors %}
                            <div class="form-error">{{ form.shipping_city.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div>
                            <label class="form-label">{{ form.shipping_postal_code.label_tag }}</label>
                            {{ form.shipping_postal_code }}
                            <div class="text-xs text-gray-500 mt-1">Enter 6-digit PIN code</div>
                            {% if form.shipping_postal_code.errors %}
                            <div class="form-error">{{ form.shipping_postal_code.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <div>
                        <label class="form-label">{{ form.shipping_state.label_tag }}</label>
                        {{ form.shipping_state }}
                        <div class="text-xs text-gray-500 mt-1">State may auto-fill from PIN</div>
                        {% if form.shipping_state.errors %}
                        <div class="form-error">{{ form.shipping_state.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label class="form-label">{{ form.shipping_country.label_tag }}</label>
                        {{ form.shipping_country }}
                        {% if form.shipping_country.errors %}
                        <div class="form-error">{{ form.shipping_country.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <!-- Coupon Code -->
                    <div class="border-t pt-6">
                        <h3 class="font-semibold mb-3">Coupon Code</h3>
                        <div class="flex space-x-2">
                            <input type="text" name="coupon_code" placeholder="Enter coupon code" 
                                   class="form-input flex-1" id="coupon-input">
                            <button type="button" id="apply-coupon" class="btn btn-outline">Apply</button>
                        </div>
                        <div id="coupon-message" class="mt-2"></div>
                        <!-- Hidden field to store validated coupon for form submission -->
                        <input type="hidden" name="validated_coupon" id="validated-coupon" value="">
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Order Summary -->
        <div class="bg-white rounded-lg shadow-sm p-6 h-fit sticky top-24 max-w-md mx-auto">
            <h2 class="text-xl font-bold mb-6 text-gray-800">Order Summary</h2>
            
            <div class="space-y-4 mb-6">
                {% for item in cart.items.all %}
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        {% if item.product.image %}
                        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" 
                             class="w-12 h-12 object-cover rounded">
                        {% else %}
                        <div class="w-12 h-12 bg-gray-200 flex items-center justify-center rounded">
                            <i class="fas fa-image text-gray-400 text-xs"></i>
                        </div>
                        {% endif %}
                        <div>
                            <h4 class="font-semibold">{{ item.product.name }}</h4>
                            <p class="text-sm text-gray-600">Qty: {{ item.quantity }}</p>
                        </div>
                    </div>
                    <span class="font-bold">₹{{ item.get_total_price }}</span>
                </div>
                {% endfor %}
            </div>
            
            <div class="border-t pt-4 space-y-2 mb-6">
                <div class="flex justify-between">
                    <span>Subtotal:</span>
                    <span id="subtotal">₹{{ cart.get_total_price }}</span>
                </div>
                <div class="flex justify-between text-green-600" id="discount-row" style="display: none;">
                    <span>Discount:</span>
                    <span id="discount-amount">-₹0.00</span>
                </div>
                <div class="flex justify-between">
                    <span>Shipping:</span>
                    <span class="text-green-600">Free</span>
                </div>
                <div class="border-t pt-2 flex justify-between font-bold text-lg">
                    <span>Total:</span>
                    <span id="final-total">₹{{ cart.get_total_price }}</span>
                </div>
            </div>
            
            <button type="submit" form="checkout-form" class="btn btn-primary w-full">
                Place Order <i class="fas fa-credit-card ml-2"></i>
            </button>
        </div>
    </div>
</div>

<!-- Add Address Modal -->
<div id="add-address-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <!-- Modal Header -->
            <div class="p-6 border-b border-gray-200 bg-gray-50">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">Add New Address</h2>
                    <button type="button" id="close-modal-btn" class="text-gray-400 hover:text-gray-600 text-2xl">
                        &times;
                    </button>
                </div>
                <p class="text-gray-600 text-sm mt-1">This address will be added to your account and selected for this order</p>
            </div>
            
            <!-- Modal Body -->
            <form id="add-address-form" class="p-6">
                {% csrf_token %}
                
                <!-- Address Type -->
                <div class="mb-4">
                    <label for="modal_address_type" class="block text-sm font-semibold text-gray-700 mb-2">
                        Address Type
                    </label>
                    <select id="modal_address_type" name="address_type" class="form-input" required>
                        <option value="home">Home</option>
                        <option value="work">Work</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <!-- Address Line 1 -->
                <div class="mb-4">
                    <label for="modal_address_line_1" class="block text-sm font-semibold text-gray-700 mb-2">
                        Address Line 1 <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="modal_address_line_1" name="address_line_1" 
                           class="form-input" placeholder="Street address, building, apartment" required>
                </div>
                
                <!-- Address Line 2 -->
                <div class="mb-4">
                    <label for="modal_address_line_2" class="block text-sm font-semibold text-gray-700 mb-2">
                        Address Line 2 <span class="text-gray-400">(Optional)</span>
                    </label>
                    <input type="text" id="modal_address_line_2" name="address_line_2" 
                           class="form-input" placeholder="Apartment, suite, unit, etc. (optional)">
                </div>
                
                <!-- City and State -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="modal_city" class="block text-sm font-semibold text-gray-700 mb-2">
                            City <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="modal_city" name="city" class="form-input" placeholder="City" required>
                    </div>
                    <div>
                        <label for="modal_state" class="block text-sm font-semibold text-gray-700 mb-2">
                            State <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="modal_state" name="state" class="form-input" placeholder="State/Province" required>
                    </div>
                </div>
                
                <!-- Postal Code and Country -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="modal_postal_code" class="block text-sm font-semibold text-gray-700 mb-2">
                            PIN Code <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="modal_postal_code" name="postal_code" 
                               class="form-input numeric-font" placeholder="PIN Code" required pattern="\d{6}">
                    </div>
                    <div>
                        <label for="modal_country" class="block text-sm font-semibold text-gray-700 mb-2">
                            Country <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="modal_country" name="country" 
                               class="form-input" placeholder="Country" value="India" required>
                    </div>
                </div>
                
                <!-- Default Address -->
                <div class="mb-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="modal_is_default" name="is_default" class="form-checkbox">
                        <label for="modal_is_default" class="ml-2 text-sm text-gray-700">
                            Set as default address
                        </label>
                    </div>
                </div>
                
                <!-- Error Display -->
                <div id="modal-errors" class="hidden mb-4 p-4 bg-red-50 border border-red-200 rounded-lg">
                    <ul class="text-red-600 text-sm list-disc list-inside"></ul>
                </div>
            </form>
            
            <!-- Modal Footer -->
            <div class="p-6 border-t border-gray-200 bg-gray-50">
                <div class="flex flex-col sm:flex-row gap-3 sm:justify-end">
                    <button type="button" id="cancel-address-btn" 
                            class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" form="add-address-form" id="save-address-btn" 
                            class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        <i class="fas fa-save mr-2"></i>Save Address
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Address selection and form auto-fill functionality
document.addEventListener('DOMContentLoaded', function() {
    const addressOptions = document.querySelectorAll('input[name="selected_address"]');
    const newAddressRadio = document.getElementById('new_address_radio');
    const addressForm = document.getElementById('checkout-form');
    
    // Modal elements
    const addAddressModal = document.getElementById('add-address-modal');
    const addAddressModalBtn = document.getElementById('add-address-modal-btn');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const cancelAddressBtn = document.getElementById('cancel-address-btn');
    const addAddressForm = document.getElementById('add-address-form');
    const modalErrors = document.getElementById('modal-errors');
    const modalPinCode = document.getElementById('modal_postal_code');
    const modalCity = document.getElementById('modal_city');
    const modalState = document.getElementById('modal_state');
    const modalCountry = document.getElementById('modal_country');
    
    // Handle address selection
    addressOptions.forEach(function(radio) {
        radio.addEventListener('change', function() {
            if (this.value && this.value !== '') {
                // Selected a saved address, fetch and fill form
                fetchAddressData(this.value);
                setFormFieldsReadonly(true);
            } else {
                // Selected "new address", enable manual entry
                clearFormFields();
                setFormFieldsReadonly(false);
            }
        });
    });
    
    // If default address is selected on page load, fill the form
    const checkedAddress = document.querySelector('input[name="selected_address"]:checked');
    if (checkedAddress && checkedAddress.value) {
        fetchAddressData(checkedAddress.value);
        setFormFieldsReadonly(true);
    }
    
    function fetchAddressData(addressId) {
        if (!addressId) return;
        
        fetch(`/accounts/addresses/json/${addressId}/`)
            .then(response => response.json())
            .then(data => {
                if (!data.error) {
                    fillFormFields(data);
                }
            })
            .catch(error => {
                console.error('Error fetching address:', error);
            });
    }
    
    function fillFormFields(addressData) {
        const fields = {
            'id_shipping_address': addressData.address_line_1 + (addressData.address_line_2 ? ', ' + addressData.address_line_2 : ''),
            'id_shipping_city': addressData.city,
            'id_shipping_state': addressData.state,
            'id_shipping_postal_code': addressData.postal_code,
            'id_shipping_country': addressData.country
        };
        
        Object.keys(fields).forEach(function(fieldId) {
            const field = document.getElementById(fieldId);
            if (field) {
                field.value = fields[fieldId];
            }
        });
    }
    
    function clearFormFields() {
        const fieldIds = ['id_shipping_address', 'id_shipping_city', 'id_shipping_state', 'id_shipping_postal_code', 'id_shipping_country'];
        fieldIds.forEach(function(fieldId) {
            const field = document.getElementById(fieldId);
            if (field) {
                field.value = '';
            }
        });
    }
    
    function setFormFieldsReadonly(readonly) {
        const fieldIds = ['id_shipping_address', 'id_shipping_city', 'id_shipping_state', 'id_shipping_postal_code', 'id_shipping_country'];
        fieldIds.forEach(function(fieldId) {
            const field = document.getElementById(fieldId);
            if (field) {
                if (readonly) {
                    field.setAttribute('readonly', 'readonly');
                    field.classList.add('bg-gray-100', 'cursor-not-allowed');
                } else {
                    field.removeAttribute('readonly');
                    field.classList.remove('bg-gray-100', 'cursor-not-allowed');
                }
            }
        });
    }
    
    // Modal functionality
    if (addAddressModalBtn) {
        addAddressModalBtn.addEventListener('click', function() {
            showModal();
        });
    }
    
    if (closeModalBtn) {
        closeModalBtn.addEventListener('click', function() {
            hideModal();
        });
    }
    
    if (cancelAddressBtn) {
        cancelAddressBtn.addEventListener('click', function() {
            hideModal();
        });
    }
    
    // Close modal when clicking outside
    if (addAddressModal) {
        addAddressModal.addEventListener('click', function(e) {
            if (e.target === addAddressModal) {
                hideModal();
            }
        });
    }
    
    // Handle modal form submission
    if (addAddressForm) {
        addAddressForm.addEventListener('submit', function(e) {
            e.preventDefault();
            submitNewAddress();
        });
    }
    
    // PIN code auto-fill functionality in modal
    if (modalPinCode) {
        modalPinCode.addEventListener('blur', function() {
            const pinCode = this.value.trim();
            if (pinCode && /^\d{6}$/.test(pinCode)) {
                fetchPinCodeData(pinCode);
            }
        });
    }
    
    function showModal() {
        if (addAddressModal) {
            addAddressModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
    }
    
    function hideModal() {
        if (addAddressModal) {
            addAddressModal.classList.add('hidden');
            document.body.style.overflow = '';
            clearModalForm();
            hideModalErrors();
        }
    }
    
    function clearModalForm() {
        if (addAddressForm) {
            addAddressForm.reset();
            modalCountry.value = 'India'; // Reset default country
        }
    }
    
    function showModalErrors(errors) {
        if (modalErrors) {
            const errorList = modalErrors.querySelector('ul');
            errorList.innerHTML = '';
            
            for (const [field, messages] of Object.entries(errors)) {
                messages.forEach(message => {
                    const li = document.createElement('li');
                    li.textContent = `${field}: ${message}`;
                    errorList.appendChild(li);
                });
            }
            
            modalErrors.classList.remove('hidden');
        }
    }
    
    function hideModalErrors() {
        if (modalErrors) {
            modalErrors.classList.add('hidden');
        }
    }
    
    function fetchPinCodeData(pinCode) {
        fetch(`https://api.postalpincode.in/pincode/${pinCode}`)
            .then(response => response.json())
            .then(data => {
                if (data && data[0] && data[0].Status === 'Success' && data[0].PostOffice) {
                    const postOffice = data[0].PostOffice[0];
                    if (modalCity && !modalCity.value) {
                        modalCity.value = postOffice.District || postOffice.Region || '';
                    }
                    if (modalState && !modalState.value) {
                        modalState.value = postOffice.State || '';
                    }
                    if (modalCountry && !modalCountry.value) {
                        modalCountry.value = postOffice.Country || 'India';
                    }
                }
            })
            .catch(error => {
                console.error('Error fetching PIN code data:', error);
            });
    }
    
    function submitNewAddress() {
        const formData = new FormData(addAddressForm);
        const saveButton = document.getElementById('save-address-btn');
        const originalButtonText = saveButton.innerHTML;
        
        // Show loading state
        saveButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';
        saveButton.disabled = true;
        
        hideModalErrors();
        
        fetch('/accounts/addresses/ajax-add/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Address created successfully
                addNewAddressOption(data.address_data);
                hideModal();
                
                // Show success message
                showSuccessMessage(data.message);
            } else {
                // Show validation errors
                if (data.errors) {
                    showModalErrors(data.errors);
                } else {
                    showModalErrors({ 'General': [data.message || 'An error occurred'] });
                }
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showModalErrors({ 'Network': ['Failed to save address. Please try again.'] });
        })
        .finally(() => {
            // Reset button state
            saveButton.innerHTML = originalButtonText;
            saveButton.disabled = false;
        });
    }
    
    function addNewAddressOption(addressData) {
        // Create new address option HTML
        const addressContainer = document.querySelector('.space-y-2');
        if (addressContainer) {
            const newAddressOption = createAddressOptionElement(addressData);
            
            // Insert before the "Use a new address" option
            const newAddressRadioContainer = document.querySelector('[data-address-id="new"]').parentElement;
            addressContainer.insertBefore(newAddressOption, newAddressRadioContainer);
            
            // Select the new address
            const newRadio = newAddressOption.querySelector('input[type="radio"]');
            newRadio.checked = true;
            
            // Trigger the change event to fill the form
            const changeEvent = new Event('change', { bubbles: true });
            newRadio.dispatchEvent(changeEvent);
        }
    }
    
    function createAddressOptionElement(addressData) {
        const addressOption = document.createElement('label');
        addressOption.className = 'flex items-start space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer address-option';
        addressOption.setAttribute('data-address-id', addressData.id);
        
        const iconClass = addressData.address_type === 'home' ? 'home' : 
                         addressData.address_type === 'work' ? 'building' : 'map-marker-alt';
        
        const defaultBadge = addressData.is_default ? 
            '<span class="bg-red-600 text-white px-2 py-1 rounded text-xs font-semibold">DEFAULT</span>' : '';
        
        addressOption.innerHTML = `
            <input type="radio" name="selected_address" value="${addressData.id}" class="mt-1">
            <div class="flex-1">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-${iconClass} text-red-600"></i>
                    <span class="font-semibold">${addressData.address_type_display}</span>
                    ${defaultBadge}
                </div>
                <p class="text-sm text-gray-600 mt-1">${addressData.full_address}</p>
            </div>
        `;
        
        // Add event listener to the new radio button
        const radio = addressOption.querySelector('input[type="radio"]');
        radio.addEventListener('change', function() {
            if (this.value && this.value !== '') {
                fetchAddressData(this.value);
                setFormFieldsReadonly(true);
            }
        });
        
        return addressOption;
    }
    
    function showSuccessMessage(message) {
        // Create a temporary success message
        const successDiv = document.createElement('div');
        successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
        successDiv.innerHTML = `<i class="fas fa-check mr-2"></i>${message}`;
        
        document.body.appendChild(successDiv);
        
        // Remove after 3 seconds
        setTimeout(() => {
            document.body.removeChild(successDiv);
        }, 3000);
    }
});

// Legacy saved address functionality
const useSavedCheckbox = document.getElementById('use_saved');
if (useSavedCheckbox) {
    useSavedCheckbox.addEventListener('change', function() {
        const fields = document.querySelectorAll('#checkout-form input[type="text"], #checkout-form textarea');
        fields.forEach(field => {
            field.disabled = this.checked;
            if (this.checked) {
                field.classList.add('bg-gray-100');
            } else {
                field.classList.remove('bg-gray-100');
            }
        });
    });
}
</script>

<style>
.form-input, .form-select {
    @apply w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors;
}

.form-checkbox {
    @apply h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded;
}

.numeric-font {
    font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
    font-variant-numeric: tabular-nums;
}

/* Modal specific styles */
#add-address-modal {
    backdrop-filter: blur(4px);
}

.modal-content {
    max-height: 90vh;
    overflow-y: auto;
}

/* Address selection styles */
.address-option:hover {
    border-color: #ef4444;
}

.address-option input[type="radio"]:checked + div {
    color: #dc2626;
}

.address-option input[type="radio"]:checked {
    background-color: #dc2626;
    border-color: #dc2626;
}

/* Loading spinner animation */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.fa-spin {
    animation: spin 1s linear infinite;
}

/* Success message animation */
@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.fixed.top-4.right-4 {
    animation: slideInRight 0.3s ease-out;
}
</style>
{% endblock %}
