{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Invoice #{{ order.order_number }} - JOOG{% endblock %}

{% block extra_head %}
<style>
    .admin-invoice-header {
        background: linear-gradient(135deg, #E53E3E 0%, #C53030 100%);
    }
    .invoice-section {
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem;
        background: white;
    }
    .tax-breakdown {
        background: linear-gradient(to right, #f8fafc, #f1f5f9);
    }
    .amount-highlight {
        font-family: 'Inter', sans-serif;
        font-weight: 700;
        color: var(--red-primary);
    }
    .admin-badge {
        background: linear-gradient(45deg, #ef4444, #dc2626);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 9999px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-size: 0.75rem;
    }
    @media print {
        .no-print { display: none !important; }
        .invoice-section { border: 1px solid #000; }
        body { background: white !important; }
    }
</style>
{% endblock %}

{% block content %}
<div class="bg-gray-50 min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-5xl">
        <!-- Back Button -->
        <div class="mb-6 no-print">
            <a href="{% url 'accounts:admin_invoices' %}" class="inline-flex items-center text-gray-600 hover:text-red-600 transition-colors">
                <i class="fas fa-arrow-left mr-2"></i>Back to Invoice Management
            </a>
        </div>

        <!-- Invoice Container -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <!-- Admin Invoice Header -->
            <div class="admin-invoice-header text-white p-8">
                <div class="flex flex-col md:flex-row justify-between items-start">
                    <div>
                        <div class="flex items-center mb-4">
                            <h1 class="text-3xl font-bold mr-4" style="font-family: 'Playfair Display', serif;">
                                Admin Tax Invoice
                            </h1>
                            <span class="admin-badge">
                                <i class="fas fa-shield-alt mr-1"></i>Admin View
                            </span>
                        </div>
                        <p class="text-gray-300">Invoice #{{ order.order_number }}</p>
                        <p class="text-gray-300 text-sm">Generated for administrative purposes</p>
                    </div>
                    <div class="mt-4 md:mt-0 text-right">
                        <div class="text-4xl font-bold mb-2">JOOG</div>
                        <div class="text-gray-300 text-sm">Premium Fashion Retailer</div>
                        <div class="text-gray-300 text-xs mt-2">Admin Dashboard</div>
                    </div>
                </div>
            </div>

            <!-- Invoice Details -->
            <div class="p-8">
                <!-- Order Summary for Admin -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8">
                    <h3 class="text-lg font-semibold text-blue-900 mb-4">
                        <i class="fas fa-info-circle mr-2"></i>Order Summary
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
                        <div>
                            <span class="text-blue-700 font-medium">Order ID:</span>
                            <div class="text-blue-900">{{ order.id }}</div>
                        </div>
                        <div>
                            <span class="text-blue-700 font-medium">Status:</span>
                            <div class="text-blue-900">{{ order.get_status_display }}</div>
                        </div>
                        <div>
                            <span class="text-blue-700 font-medium">Payment Status:</span>
                            <div class="text-green-700 font-semibold">
                                <i class="fas fa-check-circle mr-1"></i>{{ order.get_payment_status_display }}
                            </div>
                        </div>
                        <div>
                            <span class="text-blue-700 font-medium">Created:</span>
                            <div class="text-blue-900">{{ order.created_at|date:"M d, Y H:i" }}</div>
                        </div>
                    </div>
                </div>

                <!-- Company & Customer Info -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- From (Company) -->
                    <div class="invoice-section p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 border-b border-red-200 pb-3">
                            <i class="fas fa-building mr-2 text-red-primary"></i>From (Seller Details)
                        </h3>
                        <div class="space-y-2 text-gray-700">
                            <div class="font-semibold text-gray-900">JAGAD CLOTHINGS PRIVATE LIMITED</div>
                            <div class="text-sm text-red-primary font-medium">Trading as: JOOG (Premium Fashion Brand)</div>
                            <div>23/1, Ground Floor, Srinivasa Complex,</div>
                            <div>2nd Mn. CKC Garden, Mission Road,</div>
                            <div>Bengaluru-560 027</div>
                            <div>India</div>
                            <div class="pt-2">
                                <div><strong>GSTIN:</strong> 29AAAAA0000A1Z5</div>
                                <div><strong>PAN:</strong> AAAAA0000A</div>
                                <div><strong>CIN:</strong> U18101KA2020PTC000000</div>
                                <div><strong>Email:</strong> orders@joog.com</div>
                                <div><strong>Phone:</strong> +91 98765 43210</div>
                            </div>
                        </div>
                    </div>

                    <!-- To (Customer) -->
                    <div class="invoice-section p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4 border-b border-blue-200 pb-3">
                            <i class="fas fa-user mr-2 text-blue-600"></i>Bill To (Buyer Details)
                        </h3>
                        <div class="space-y-2 text-gray-700">
                            <div class="font-semibold text-gray-900">{{ order.user.get_full_name|default:order.user.username }}</div>
                            {% if order.selected_address %}
                                <div>{{ order.selected_address.address_line_1 }}</div>
                                {% if order.selected_address.address_line_2 %}
                                <div>{{ order.selected_address.address_line_2 }}</div>
                                {% endif %}
                                <div>{{ order.selected_address.city }}, {{ order.selected_address.state }} {{ order.selected_address.postal_code }}</div>
                                <div>{{ order.selected_address.country }}</div>
                            {% elif order.shipping_address %}
                                <div>{{ order.shipping_address }}</div>
                                <div>{{ order.shipping_city }}, {{ order.shipping_state }} {{ order.shipping_postal_code }}</div>
                                <div>{{ order.shipping_country }}</div>
                            {% else %}
                                <div class="text-gray-500 italic">Address not available</div>
                            {% endif %}
                            <div class="pt-2">
                                <div><strong>Email:</strong> {{ order.user.email }}</div>
                                <div><strong>Customer ID:</strong> {{ order.user.id }}</div>
                                <div><strong>Registered:</strong> {{ order.user.date_joined|date:"M d, Y" }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Invoice Meta Information -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-gray-50 p-4 rounded-lg text-center">
                        <div class="text-sm text-gray-600 mb-1">Invoice Date</div>
                        <div class="font-semibold">{{ order.created_at|date:"M d, Y" }}</div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg text-center">
                        <div class="text-sm text-gray-600 mb-1">Payment Method</div>
                        <div class="font-semibold capitalize">{{ order.payment_method|default:"Online Payment" }}</div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg text-center">
                        <div class="text-sm text-gray-600 mb-1">Payment Status</div>
                        <div class="font-semibold text-green-600">
                            <i class="fas fa-check-circle mr-1"></i>Paid
                        </div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg text-center">
                        <div class="text-sm text-gray-600 mb-1">Transaction ID</div>
                        <div class="font-semibold text-xs">{{ order.order_number|slice:":8" }}...</div>
                    </div>
                </div>

                <!-- Order Items -->
                <div class="invoice-section mb-8">
                    <div class="bg-gray-50 px-6 py-4 border-b">
                        <h3 class="text-lg font-semibold text-gray-900">
                            <i class="fas fa-list mr-2 text-red-primary"></i>Order Items ({{ order.items.count }} item{{ order.items.count|pluralize }})
                        </h3>
                    </div>
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-3 px-2 font-semibold text-gray-700">Description</th>
                                        <th class="text-center py-3 px-2 font-semibold text-gray-700">Quantity</th>
                                        <th class="text-right py-3 px-2 font-semibold text-gray-700">Base Price</th>
                                        <th class="text-center py-3 px-2 font-semibold text-gray-700">Tax %</th>
                                        <th class="text-right py-3 px-2 font-semibold text-gray-700">Tax Amount</th>
                                        <th class="text-right py-3 px-2 font-semibold text-gray-700">Total Price</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in order.items.all %}
                                    <tr class="border-b border-gray-100">
                                        <td class="py-4 px-2">
                                            <div class="flex items-center">
                                                {% if item.product.image %}
                                                <img src="{{ item.product.image.url }}" 
                                                     alt="{{ item.product.name }}" 
                                                     class="w-12 h-12 object-cover rounded-lg mr-4">
                                                {% else %}
                                                <div class="w-12 h-12 bg-gray-200 rounded-lg mr-4 flex items-center justify-center">
                                                    <i class="fas fa-image text-gray-400"></i>
                                                </div>
                                                {% endif %}
                                                <div>
                                                    <div class="font-semibold text-gray-900">{{ item.product.name }}</div>
                                                    {% if item.size %}<div class="text-sm text-gray-500">Size: {{ item.size }}</div>{% endif %}
                                                    {% if item.product.category %}<div class="text-xs text-blue-600">{{ item.product.category.name }}</div>{% endif %}
                                                </div>
                                            </div>
                                        </td>
                                        <td class="py-4 px-2 text-center">{{ item.quantity }}</td>
                                        <td class="py-4 px-2 text-right">₹{{ item.base_price|floatformat:2 }}</td>
                                        <td class="py-4 px-2 text-center">{{ item.product.tax_percentage|default:"18" }}%</td>
                                        <td class="py-4 px-2 text-right">₹{{ item.tax_amount|floatformat:2 }}</td>
                                        <td class="py-4 px-2 text-right font-semibold">₹{{ item.get_total_price|floatformat:2 }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Admin Bill Summary -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Discount & Total Information -->
                    <div class="invoice-section">
                        <div class="bg-gray-50 px-6 py-4 border-b">
                            <h3 class="text-lg font-semibold text-gray-900">
                                <i class="fas fa-receipt mr-2 text-red-primary"></i>Admin Bill Summary
                            </h3>
                        </div>
                        <div class="p-6">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                                <div class="text-blue-800 text-sm font-medium mb-1">
                                    <i class="fas fa-info-circle mr-1"></i>Admin Note: All amounts are shown as final billing amounts
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <div class="flex justify-between items-center py-2 border-b border-gray-200">
                                    <span class="text-gray-700 font-medium">Total Amount:</span>
                                    <span class="font-semibold text-lg">₹{{ order.total_amount|floatformat:2 }}</span>
                                </div>
                                
                                {% if order.discount_amount > 0 %}
                                <div class="flex justify-between items-center py-2 border-b border-gray-200">
                                    <div class="flex flex-col">
                                        <span class="text-green-700 font-medium">Discount Applied:</span>
                                        {% if order.coupon %}
                                        <span class="text-xs text-green-600">Coupon: {{ order.coupon.code }}</span>
                                        {% endif %}
                                        <span class="text-xs text-gray-500">Admin tracking: Revenue impact recorded</span>
                                    </div>
                                    <span class="font-semibold text-lg text-green-600">-₹{{ order.discount_amount|floatformat:2 }}</span>
                                </div>
                                {% endif %}
                                
                                <div class="flex justify-between items-center py-3 border-t-2 border-gray-400 bg-red-50 rounded-lg px-4">
                                    <span class="text-gray-900 font-bold text-xl">Final Amount Received:</span>
                                    <span class="font-bold text-2xl text-red-primary">₹{{ order.final_amount|floatformat:2 }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Total Amount -->
                    <div class="invoice-section">
                        <div class="bg-gradient-to-r from-red-primary to-red-accent text-white px-6 py-4 border-b">
                            <h3 class="text-lg font-semibold">
                                <i class="fas fa-rupee-sign mr-2"></i>Final Amount
                            </h3>
                        </div>
                        <div class="p-6 text-center">
                            <div class="mb-4">
                                <div class="text-4xl amount-highlight mb-2">₹{{ order.final_amount }}</div>
                                <div class="text-gray-600">Total Amount Received</div>
                            </div>
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                                <div class="text-green-800 font-semibold mb-1">
                                    <i class="fas fa-check-circle mr-2"></i>Payment Confirmed
                                </div>
                                <div class="text-green-600 text-sm">
                                    Received on {{ order.created_at|date:"M d, Y g:i A" }}
                                </div>
                            </div>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                <div class="text-blue-800 text-sm font-medium">
                                    Commission/Revenue Impact
                                </div>
                                <div class="text-blue-600 text-xs mt-1">
                                    Admin tracking: Order processed successfully
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 mb-8 no-print">
                    <a href="{% url 'accounts:download_admin_invoice' order.order_number %}" 
                       class="btn btn-primary inline-flex items-center justify-center">
                        <i class="fas fa-download mr-2"></i>Download Admin PDF
                    </a>
                    <button onclick="window.print()" 
                            class="btn btn-outline inline-flex items-center justify-center">
                        <i class="fas fa-print mr-2"></i>Print Admin Invoice
                    </button>
                    <a href="{% url 'orders:order_detail' order.order_number %}" 
                       class="btn btn-secondary inline-flex items-center justify-center">
                        <i class="fas fa-box mr-2"></i>View Full Order
                    </a>
                    <a href="mailto:{{ order.user.email }}?subject=Regarding Order {{ order.order_number }}" 
                       class="btn bg-purple-600 text-white hover:bg-purple-700 inline-flex items-center justify-center">
                        <i class="fas fa-envelope mr-2"></i>Contact Customer
                    </a>
                </div>

                <!-- Admin Notes Section -->
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-8">
                    <h3 class="text-lg font-semibold text-yellow-800 mb-4">
                        <i class="fas fa-sticky-note mr-2"></i>Admin Notes & Compliance
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <div class="font-medium text-yellow-800 mb-2">Tax Compliance:</div>
                            <ul class="text-yellow-700 space-y-1">
                                <li>• GST calculated at 5% (CGST 2.5% + SGST 2.5%)</li>
                                <li>• Invoice generated as per GST guidelines</li>
                                <li>• Tax registration: 29AAAAA0000A1Z5</li>
                            </ul>
                        </div>
                        <div>
                            <div class="font-medium text-yellow-800 mb-2">Record Keeping:</div>
                            <ul class="text-yellow-700 space-y-1">
                                <li>• Digital invoice stored in system</li>
                                <li>• Customer copy available in their portal</li>
                                <li>• Backup maintained for audit purposes</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Footer Note -->
                <div class="p-6 bg-gray-50 rounded-lg text-center text-sm text-gray-600">
                    <p class="mb-2">
                        <strong>Admin Note:</strong> This is an administrative copy of the customer invoice for internal record-keeping and tax compliance.
                    </p>
                    <p>
                        Generated on {{ order.created_at|date:"M d, Y g:i A" }} | Admin Access Level | 
                        For queries: <a href="mailto:admin@joog.com" class="text-red-primary hover:underline">admin@joog.com</a>
                    </p>
                    <p class="text-xs mt-2 text-gray-500">
                        JAGAD CLOTHINGS PRIVATE LIMITED | GSTIN: 29AAAAA0000A1Z5 | CIN: U18101KA2020PTC000000 | Admin Dashboard
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}